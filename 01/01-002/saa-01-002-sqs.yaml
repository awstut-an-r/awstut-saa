AWSTemplateFormatVersion: 2010-09-09

Parameters:
  Prefix:
    Type: String
    Default: saa-01-002
    

Resources:
  Queue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: !Sub ${Prefix}-queue
      ReceiveMessageWaitTimeSeconds: 20
      VisibilityTimeout: 90
  
  SQSEndpoint:
    Type: AWS::EC2::VPCEndpoint
    Properties:
      PrivateDnsEnabled: true
      SecurityGroupIds:
        - Fn::ImportValue: !Sub ${Prefix}-EndpointSecurityGroup
      ServiceName: !Sub com.amazonaws.${AWS::Region}.sqs
      SubnetIds:
        - Fn::ImportValue: !Sub ${Prefix}-PrivateSubnet1
        - Fn::ImportValue: !Sub ${Prefix}-PrivateSubnet2
      VpcEndpointType: Interface
      VpcId:
        Fn::ImportValue: !Sub ${Prefix}-VPC
        
        
Outputs:
  QueueName:
    Value: !GetAtt Queue.QueueName
    Export:
      Name: !Sub ${Prefix}-QueueName
      
  QueueArn:
    Value: !GetAtt Queue.Arn
    Export:
      Name: !Sub ${Prefix}-QueueArn
